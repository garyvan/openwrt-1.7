<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OCTEON® SnortXL 3.1.0: Building and Running SnortXL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OCTEON® SnortXL 3.1.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('snort_run.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Building and Running SnortXL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="readme3"></a><a class="anchor" id="_build_snort"></a></p>
<h1><a class="anchor" id="intro_install_build"></a>
1. Building SnortXL for OCTEON®</h1>
<ol type="1">
<li>Set OCTEON environment as follows <pre class="fragment">    # cd /usr/local/Cavium_Networks/OCTEON-SDK/
    # source env-setup &lt;OCTEON_MODEL&gt;
</pre></li>
<li>The following commands will compile SnortXL and place Snort binary in install.linux/bin directory. <pre class="fragment">    # cd $OCTEON_ROOT/components/snortxl
    # make clean
    # make all</pre></li>
<li>SnortXL requires rules and configuration files to be compiled on an x86 host in a format acceptable to HFA engine. To use snort rules and configuration bundled with this package, skip this step, as they are already precompiled. For custom rules and configurations, refer to <a class="el" href="snort_compiler.html#readme2">SnortXL Rule Compiler</a> for details on compiling snort rules for OCTEON SnortXL.</li>
</ol>
<p>The recommended method to run snortXL on OCTEON LINUX is to create linux image with embedded snortxl as detailed in the next section. However, you can also copy the required binaries and input files onto a storage medium and transfer it to Linux as mentioned in <a class="el" href="snort_run.html#_copy_snort">Running SnortXL on linux without embedded SnortXL</a></p>
<h1><a class="anchor" id="snort_rootfs"></a>
2. Building linux with embedded snortxl in rootfs</h1>
<p>This section provides an overview on how to create linux image with embedded snortxl. Ensure that you have followed the steps as detailed in SDK documentation to build linux image before proceeding with the instructions to create rootfs in the following sections. </p>
<h2><a class="anchor" id="create_rootfs"></a>
2.1 Create rootfs</h2>
<p>a) First compile linux as per instructions in OCTEON SDK documentation. Once linux is compiled, execute the following steps to create rootfs:</p>
<pre class="fragment">    # cd $OCTEON_ROOT/linux/embedded_rootfs
    # make clean
    # make all
</pre><p> This will create rootfs in /tmp directory with name <b> _usr_local_Cavium_Networks_OCTEON-SDK_linux_embedded_rootfs-rootfs </b></p>
<p>b) Create snortxl directory in rootfs : </p>
<pre class="fragment">    # cd  /tmp/_usr_local_Cavium_Networks_OCTEON-SDK_linux_embedded_rootfs-rootfs/home
    # mkdir -p snortxl
</pre><p> c) Now Copy snortxl binaries , snortRuleDir , snortxl_env.sh and sample pcap file to snortxl directory in rootfs : </p>
<pre class="fragment">    # cp -rf  $OCTEON_ROOT/components/snortxl/install.linux  snortxl/install
    # cp -rf  $OCTEON_ROOT/components/snortxl/snortRuleDir   snortxl/
    # cp      $OCTEON_ROOT/components/snortxl/snortxl_env.sh snortxl/
    # cp      $OCTEON_ROOT/components/snortxl/snortRuleDir/ixhttp44k.pcap  snortxl/</pre> <dl class="section note"><dt>Note</dt><dd>Sample pcap file ixhttp44k.pcap is provided in snortRuleDir with this package. </dd></dl>
<h2><a class="anchor" id="build_linux"></a>
2.2 Build Linux</h2>
<p>Now make Linux kernel with embedded snortxl : </p>
<pre class="fragment">    # cd $OCTEON_ROOT/linux
    # make kernel
</pre><p> This will generate linux binary with embedded snortxl at Following Path </p>
<pre class="fragment">$OCTEON_ROOT/linux/kernel/linux/vmlinux.64
</pre><p>Copy this image to tftpboot and rename to snortxl_vmlinux.64: </p>
<pre class="fragment">    # cp $OCTEON_ROOT/linux/kernel/linux/vmlinux.64  /var/lib/tftpboot/snortxl_vmlinux.64
</pre><h1><a class="anchor" id="snort_run_evb"></a>
3. Running SnortXL on OCTEON® EVB</h1>
<p>SnortXL in Linux mode can be run in the following modes:</p>
<ul>
<li>File Read Mode for Pcap Files</li>
<li>Inline Mode for Network Traffic using OCTEON DAQ</li>
<li>Inline Mode for Network Traffic using AFPACKET DAQ [Experimental]</li>
</ul>
<p>A console serial cable is required to view serial output from OCTEON® EVB. Replace the fields in &lt;braces&gt; using appropriate values. The memory allocated to Linux should be modified appropriately for custom rules and configurations. Larger rule-sets may require more memory. If graph memory is exhausted for custom configurations then value of OCTEON_HFA_MEMORY_SIZE and OCTEON_HFA_ARENA_SIZE need to be increased appropriately. These values can be configured in $OCTEON_ROOT/components/hfa/drv/include/config/octeon-hfa-drv-config.h. SnortXL need to be recompiled after updating these macros. Default values are applicable for the bundled configurations.</p>
<p>Follow below mentioned steps:</p>
<h2><a class="anchor" id="snort_boot"></a>
3.1 Booting Linux with embedded SnortXL.</h2>
<p>Run the following commands on the OCTEON® bootloader prompt to boot linux binary <b>"snortxl_vmlinux.64"</b> with embedded SnortXL . Set numcores and mem options according to your requirements. Ensure enough bootmem is available as mentioned in the setup section</p>
<pre class="fragment">    Octeon evb7000# tftpboot 0 snortxl_vmlinux.64
    Octeon evb7000# bootoctlinux 0 numcores=&lt;num_cores&gt; mem=1024M</pre><p> This will boot Linux. For linux with embedded SnortXL, the binaries and input files will be present at <b>/home/snortxl</b>. In case the binaries are not embedded, copy the required input files at <b>/home/snortxl</b> <a class="anchor" id="_setup_snort"></a></p>
<h2><a class="anchor" id="snort_environment"></a>
3.2 Setup SnortXL environment on Linux.</h2>
<p>On linux prompt execute following instructions to setup the environment: </p>
<pre class="fragment">    # cd /home/snortxl
    # source snortxl_env.sh
</pre> <h2><a class="anchor" id="snort_pcap"></a>
3.3 Running SnortXL in Pcap File read mode.</h2>
<p>To run Snort in PCAP File Read mode using the sample pcap execute the following command on Linux prompt: </p>
<pre class="fragment">    # snort -H -c snortRuleDir/snort.conf --daq pcap -r ixhttp44k.pcap -A console -N
</pre> <h2><a class="anchor" id="snort_inline"></a>
3.4 Running SnortXL in NIDS mode using OCTEON DAQ</h2>
<p>This is a high performing mode in which packets are picked up directly from the SSO by the OCTEON Data Acquisition module. Ensure that OCTEON ethernet module is removed before running SnortXL. To run SnortXL in this mode, execute the following command:</p>
<pre class="fragment">    # snort -H -c snortRuleDir/snort.conf -i 1:2 -Q -A console -N</pre><p> In this example, network traffic will be toggled between the IPD ports 1 and 2. For multiple IPD port pairs use "-i 0:1::2:3".</p>
<h2><a class="anchor" id="snort_inline_afp"></a>
3.5 Running SnortXL in NIDS mode using AFPACKET DAQ</h2>
<p>This is an experimental mode to run SnortXL in NIDS mode using AFPACKET Data Acquisition module. This mode requires octeon-ethernet driver to be present and interfaces to be up . However SnortXL can be run only on a single core only. </p>
<pre class="fragment">    #ifconfig eth0 up
    #ifconfig eth1 up
    # snort -H -c snortRuleDir/snort.conf --daq afpacket  --daq-mode inline -i eth0:eth1 --daq-var buffer_size_mb=100 -A console -N
</pre><p> In this example, network traffic will be toggled between the ethernet ports eth0 and eth1. for multiple ethernet port pairs use "-i eth0:eth1::eth2:eth3".</p>
<p>For better performance , boot linux on 2 OCTEON cores, and use schedtool to run SnortXL on core 1. This will ensure that ethernet driver and SnortXL run on different cores, resulting in a higher performance. </p>
<pre class="fragment">    #schedtool -e -a 0x1 snort -H -c snortRuleDir/snort.conf --daq afpacket  --daq-mode inline -i eth0:eth1 --daq-var buffer_size_mb=100 -A console -N</pre><p> <a class="anchor" id="_copy_snort"></a></p>
<h1><a class="anchor" id="snort_run_usb"></a>
4. Running SnortXL on linux without embedded SnortXL.</h1>
<p>SnortXL can be run on OCTEON Board running linux without SnortXL embedded in it :</p>
<ol type="1">
<li>Build SnortXL on host system as mentioned in <a class="el" href="snort_run.html#_build_snort">Build SnortXL</a> section. You can skip Create rootfs section.</li>
<li>Copy following files from host system to USB or MMC device. <pre class="fragment">   1. $OCTEON_ROOT/components/snortxl/install.linux   (directory containing snortxl binaries)
   2. $OCTEON_ROOT/components/snortxl/snortxl_env.sh
   3. $OCTEON_ROOT/components/snortxl/snortRuleDir    (Rules Directory)
   4. $OCTEON_ROOT/components/snortxl/snortRuleDir/ixhttp44k.pcap    (sample pcap file)
</pre></li>
<li>Now create directory <b>"/home/snortxl"</b> on target linux system and copy above listed files to it (via USB or MMC) <pre class="fragment">    mkdir -p /home/snortxl</pre></li>
<li>Now continue with section <a class="el" href="snort_run.html#_setup_snort">Setup SnortXL environment on Linux</a> to run SnortXL on OCTEON® EVB. </li>
</ol>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>

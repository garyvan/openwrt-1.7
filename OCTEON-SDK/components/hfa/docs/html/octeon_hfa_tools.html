<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OCTEON HFA SDK 3.1.0: OCTEON HFA TOOLS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OCTEON HFA SDK 3.1.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('octeon_hfa_tools.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">OCTEON HFA TOOLS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All HFA tools are present in $HFAROOT/tools/x86 and $HFAROOOT/tools/octeon directory</p>
<h1><a class="anchor" id="hfa_compiler"></a>
HFA RegEx Complier</h1>
<p><b>hfac</b> is the pattern compiler for Cavium HFA device. This can be used to compile the patterns (can be strings or regular expressions) into a graph which can be downloaded to the HFA device. Once the graph is downloaded, the HFA device can be used to match the compiled patterns in any payload submitted to it. Reference patterns are available under apps/ref-patterns/. See <a class="el" href="octeon_hfa_syntax.html">OCTEON HFA COMPILER PATTERN SYNTAX</a> for the syntax supported. The compiler usage is as follows: </p>
<pre class="fragment">$ hfac -target &lt;OCTEON HFA TARGETS&gt; [options]
</pre><p>where <b>options</b> can be the following:</p>
<dl>
<dt></dt>
<dd><br/>
 </dd>
<dt><em>-help</em> </dt>
<dd>Display the help and exit </dd>
<dt><em>-minlen &lt;number&gt;</em> </dt>
<dd>This parameter determines what must be the minimum length of the pattern that goes into HFA hardware. Should be used with <b>-sc</b> and <b>-rc</b> modes only. The default value is 3. Compiler in -rc mode will drop all patterns where the length of portion that can goes into HFA hardware is less than the minlen value. <br/>
 </dd>
<dt><em>-linkable</em> </dt>
<dd>Make the output graph <b>linkable</b> with other graphs using <em>hfal</em> command. Note that <b>memonly</b> graphs cannot be linked. <br/>
 </dd>
<dt><em>-quiet</em> </dt>
<dd>Do not display compilation progress (useful to run in batch mode) <br/>
 </dd>
<dt><em>-version</em> </dt>
<dd>Display the compiler version number and exit <br/>
 </dd>
<dt><em>-force</em> </dt>
<dd><p class="startdd">By default, hfac identifies patterns which could cause performance degradation. Such patterns will be reported in a warning file(hfa.warn) and excluded from the compilation. </p>
<p>For example, if pattern is "......", it will be excluded. </p>
<p class="enddd">This option forces hfac not to ignore such patterns. <br/>
<br/>
 </p>
</dd>
</dl>
<h2><a class="anchor" id="hfatools_ipop"></a>
Input, Output and Target Device</h2>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-input &lt;file&gt;</em> </dt>
<dd>Name of the file containing the patterns to be compiled. If not provided, it looks for a file named <b>input</b> in the current directory <br/>
 </dd>
<dt><em>-out &lt;file&gt;</em> </dt>
<dd>Name of the output graph file to create. Default file name is <b>hfa.out</b> <br/>
 </dd>
<dt><em>-target &lt;device&gt;</em> </dt>
<dd>Name of the target device to generate graph for. <b> This is a compulsory argument for compilation.</b> Valid device options are cn61xx, cn63xx, cn66xx, cn68xx and cn70xx. There are exceptions for cn60xx, cn61xx and cn71xx<ul>
<li>HFA on CN60XX is same as CN61XX, HFA on CN62XX is same as CN63XX and HFA on CN70XX is same as CN71XX.</li>
<li>While compiling graph for CN60XX give target option to hfac as <pre class="fragment">        hfac -input &lt;patternfile&gt; -out &lt;graphfile&gt; -target cn61xx</pre></li>
<li>While compiling graph for CN62XX give target option to hfac as <pre class="fragment">        hfac -input &lt;patternfile&gt; -out &lt;graphfile&gt; -target cn63xx</pre></li>
<li>While compiling graph for CN71XX give target option to hfac as <pre class="fragment">        hfac -input &lt;patternfile&gt; -out &lt;graphfile&gt; -target cn70xx</pre> <br/>
<br/>
 </li>
</ul>
</dd>
</dl>
<h2><a class="anchor" id="hfatools_main"></a>
Main Modes of Operation</h2>
<p><br/>
 The hfac compiler can be run in four different modes –strings, -regex, -sc or –rc modes. </p>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-rc</em> </dt>
<dd>Run in regex composite mode, i.e, patterns are in the form &lt;regex0&gt;.*&lt;regex1&gt; etc. <b>This is the default and recommended mode</b>. This mode increases run-time performance but also quite strict in dropping patterns which may affect performance. Refer -minlen option also <br/>
 <b>Note:</b> The compiler will generate an hfa.warn which includes the list of patterns which are dropped if un-supported regex features are used and -force option has no impact on that behavior. <br/>
 </dd>
<dt><em>-strings</em> </dt>
<dd>Run in strings mode, i.e, assumes all patterns are plain strings. By default, all patterns are considered as regular expressions. This mode does not support any of the RegEx feature like case-insensitive, start of offset etc. Strings mode assumes all patterns only string literals and compiles faster. <br/>
 </dd>
<dt><em>-regex</em> </dt>
<dd>Run in regex mode. Accepts all regular expression patterns. Please refer to section <a class="el" href="octeon_hfa_syntax.html">OCTEON HFA COMPILER PATTERN SYNTAX</a> <br/>
 </dd>
<dt><em>-sc</em> </dt>
<dd>Run in string composite mode, i.e, patterns are in the form &lt;str0&gt;.*&lt;str1&gt; etc. Case-insensitive feature not supported in this mode. Refer -minlen option also <br/>
 <b>Note:</b> The compiler will generate an hfa.warn which includes the list of patterns which are dropped if un-supported regex features are used and <b>-force</b> option has no impact on that behavior. <br/>
 </dd>
<dt><em>-dfa</em> </dt>
<dd>Patterns are compiled into a plain DFA graph instead of an HFA graph. Provided for backward compatibility purposes. This mode is supported in <b>-strings</b> and <b>-regex</b> mode only. <br/>
<br/>
 </dd>
</dl>
<h2><a class="anchor" id="hfatools_cache_constraint"></a>
HFA Cache Constraints</h2>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-cachesize &lt;number&gt;</em> </dt>
<dd>Cache size specifies the amount of cache allocated to a graph. (See <b>Note</b>). The represent number of cachelines(81 bits each) allocated to a particular graph. Valid ranges are <dl>
<dt></dt>
<dd><dl>
<dt>- [32-4096] (For target cn60/61xx and cn70/71xx. Default is 4096) </dt>
<dd></dd>
<dt>- [32-16384] (For devices cn62/63xx, cn66xx and cn68xx. Default is 16384) </dt>
<dd></dd>
</dl>
</dd>
</dl>
<br/>
 <b>Note:</b> Cache portion of all graphs loaded on HFA cluster must not exceed available HFA cache size. Refer <a class="el" href="hfa_targets.html">INTRODUCTION TO OCTEON II/III FAMILY OF HFA DEVICES</a> for available HFA cache in each OCTEON targets <br/>
 </dd>
<dt><em>-memonly</em> </dt>
<dd>Create a memory only graph (cache is not used). This is useful for graphs that are rarely used as they don’t take up any cache memory. <br/>
<br/>
 </dd>
</dl>
<h2><a class="anchor" id="hfatools_opt"></a>
Optimization</h2>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-O &lt;number&gt;</em> </dt>
<dd>Optimization level is a tradeoff between graph size and run time performance. Minimum value is 1. Default value is 2. Increasing the optimization level may increase the compilation time and graph size and the output graph may increase performance. Most appropriate values for better performance and graph size lie in the range [2.0 -4.0]. This option takes floating point values. <br/>
 </dd>
<dt><em>-cachealgo &lt;algoname&gt;</em> </dt>
<dd>Influence the default caching algorithm while creating the graph. Valid only for cacheable graph and it is optional. Valid values are <dl>
<dt></dt>
<dd><dl>
<dt>- profile </dt>
<dd></dd>
<dt>- dictionary </dt>
<dd></dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<h2><a class="anchor" id="hfatools_prof"></a>
Profiling</h2>
<p>The profiling options are used by HFA compiler to improve the way the graph nodes are cached. The -cachealgo option is mandatory for all profile options. </p>
<dl>
<dt></dt>
<dd><br/>
 </dd>
<dt><em>-dict &lt;file&gt;</em> </dt>
<dd>Name of the input dictionary file to use. Mandatory argument -cachealgo dictionary. Dictionary file must contain common words in pattern file so that they can be given preference in the cached portion of the graph. Default file name is <b>hfa.dict</b> <br/>
 </dd>
<dt><em>-profile &lt;file&gt;</em> </dt>
<dd>Name of the input profile file to use. Mandatory argument -cachealgo profile. The generated graph is scanned against the specified file and frequently hit graph nodes will be given preference in the cache portion of the graph. Default file name is <b><em>hfa.profile</em></b> <br/>
 </dd>
<dt><em>-rcprofile &lt;file&gt;</em> </dt>
<dd><p class="startdd">This option applies only to <b>-rc</b> mode. The specified file must contain words which may occur in the payload frequently without contributing to matches. For eg: Consider following pattern and payload combination </p>
<pre class="fragment">File: pattern_file
            &lt;iframe.*cavm
            &lt;blockquote.*cavium
</pre> <pre class="fragment">File: payload_file
            &lt;html&gt;
            &lt;body&gt;
            &lt;iframe src="amazon"&gt;
            &lt;/iframe&gt;
            &lt;blockquote&gt;
            google
            &lt;/blockquote&gt;
            &lt;/body&gt;
            &lt;/html&gt;
</pre><p class="enddd">In this case html headers occur frequently and may cause partial matches that may affect performance. To avoid this, we can create <b>rcfile</b> having following content </p>
<pre class="fragment">File: rc_profile_file
            &lt;iframe
            &lt;blockquote
</pre><p> The argument used will be &ndash;rcprofile <b>rcfile</b>. This will allow compiler to remove these patterns from HFA graph to decrease unwanted partial matches from HFA hardware. <br/>
 </p>
</dd>
<dt><em>-appprofile &lt;profiletype&gt;</em> </dt>
<dd>Optimizes the cache usage of the HFA graph for the provided application type. This option will increase run time performance when payload files contain a lot of the patterns of particular application type. Valid application types are: <pre class="fragment">            -appprofile ips
            -appprofile avs
</pre> <br/>
 </dd>
</dl>
<h2><a class="anchor" id="hfatools_szdiag"></a>
Size Diagnostics</h2>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-diag</em> </dt>
<dd><p class="startdd">Provide diagnostic data the patterns used in the graphs. It provides data on the percentage memory usage of the graph cache on per pattern basis. For eg: Taking files mentioned above </p>
<pre class="fragment">bash&gt;# hfac -input pattern_file -out graph-file --target cn68xx -diag
Processed 2 lines
Building [&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;] 100.00%

SIZE DIAGNOSTICS
----------------

    Pattern Usage

    1   [&gt;&gt;&gt;&gt;&gt;&gt;&gt;             ] 38.89% (7/18)
    2   [&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;        ] 61.11% (11/18)
</pre><p class="enddd">Furthermore in conjunction with <b>diag</b> option of the <a class="el" href="octeon_hfa_tools.html#hfa_walker">HFA Hardware Simulator (or HFA Walker)</a> run-time performance can also be determined. Default file name <b>hfa.diag</b> <br/>
<br/>
 </p>
</dd>
</dl>
<h2><a class="anchor" id="hfatools_advances"></a>
Advanced Features</h2>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-config &lt;HFA Config file&gt;</em> </dt>
<dd>This config file can be used to restrict the types of patterns that are allowed and the options that the pattern file can be compiled with. Sample config file provided at $HFAROOT/apps/ref-files/hfa.config </dd>
</dl>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-compfactor &lt;number&gt;</em> </dt>
<dd><p class="startdd">Compression factor to use. This is tradeoff between compile time, graph size and run time performance. Valid ranges are </p>
<dl>
<dt></dt>
<dd><dl>
<dt>- [0-9] (default is 0) </dt>
<dd></dd>
</dl>
</dd>
</dl>
<p class="enddd"></p>
</dd>
<dt><em>-hashlevel</em> </dt>
<dd>Use alternate hashlevel. This option can be used to speed up graph compilation in some cases. This option can be set to 1 or 2 (default is 1). </dd>
</dl>
<p><br/>
<hr/>
<h1><a class="anchor" id="hfa_linker"></a>
HFA Graph Linker</h1>
<p><b>hfal</b> is the HFA graph linker for Cavium HFA device. It takes multiple HFA graphs and merges them into one physical graph which can be downloaded into the HFA device. This is useful to increase the number of physical graphs which can be accommodated in a HFA engine cluster-cache. Note that the graphs still exist as individual graphs and the graph-walk(pattern search) operation will need to be performed on them separately.</p>
<p>For example, if there are two pattern sets, <b><em>smtp.patterns</em></b> and <b><em>finger.patterns</em></b> , they can be compiled individually using <b><em>hfac</em></b> and later linked together into a single binary image using this command.</p>
<p>Its usage is as follows: </p>
<pre class="fragment">$ hfal [options] &lt;hfa0.out&gt; &lt;hfa1.out&gt; ...
</pre><p>where <b>options</b> can be the following:</p>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-quiet</em> </dt>
<dd>Do not display linking progress (useful to run in batch mode) <br/>
 <br/>
 </dd>
<dt><em>-version</em> </dt>
<dd>Display the linker version number and exit <br/>
 <br/>
 </dd>
<dt><em>-help</em> </dt>
<dd>Display the help and exit <br/>
 <br/>
 </dd>
<dt><em>-out &lt;file&gt;</em> </dt>
<dd>Name of the output file to create. Default file name is <em>hfa.out</em> <br/>
 <br/>
 </dd>
</dl>
<p><br/>
<hr/>
<h1><a class="anchor" id="hfa_verifier"></a>
HFA Graph/Info Verifier</h1>
<p><b>hfav</b> is the HFA graph/info verifier for Cavium HFA device. It takes HFA graph and dumps the information about the graph/info to the console and exits with error code <b>0</b> if they comply with each other and <b>-1</b> if they don't. Its usage is as follows: </p>
<pre class="fragment">$ hfav [options]
</pre><p>where <b>options</b> can be the following:</p>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-quiet</em> </dt>
<dd>Do not display information about the graph and info files <br/>
 <br/>
 </dd>
<dt><em>-version</em> </dt>
<dd>Display the verifier version number and exit <br/>
 <br/>
 </dd>
<dt><em>-help</em> </dt>
<dd>Display the help and exit <br/>
 <br/>
 </dd>
<dt><em>-out &lt;file&gt;</em> </dt>
<dd><p class="startdd">Name of the output file to verify. Default file name is <em>hfa.out</em> <br/>
 <br/>
</p>
<p class="enddd"></p>
</dd>
</dl>
<p><br/>
<hr/>
<h1><a class="anchor" id="hfa_walker"></a>
HFA Hardware Simulator (or HFA Walker)</h1>
<p><b>hfaw</b> simulates one HFA thread inside the HFA device. Given a graph and payload, it reports the matches found in the payload. Its usage is as follows: </p>
<pre class="fragment">$ hfaw [options]
</pre><p>where <b>options</b> can be the following:</p>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-quiet</em> </dt>
<dd><p class="startdd">Do not display any output</p>
<p class="enddd"></p>
</dd>
<dt><em>-version</em> </dt>
<dd><p class="startdd">Display the version number and exit</p>
<p class="enddd"></p>
</dd>
<dt><em>-help</em> </dt>
<dd><p class="startdd">Display the help and exit</p>
<p class="enddd"></p>
</dd>
<dt><em>-out &lt;file&gt;</em> </dt>
<dd><p class="startdd">Name of the input hfa graph file. Default file name is <em>hfa.out</em></p>
<p class="enddd"></p>
</dd>
<dt><em>-payload &lt;file&gt;</em> </dt>
<dd><p class="startdd">Name of the input payload file. Default file name is <em>payload</em>.</p>
<p class="enddd"></p>
</dd>
<dt><em>-allmatches</em> </dt>
<dd><p class="startdd">Report all matches. By default, only the first match is reported.</p>
<p class="enddd"></p>
</dd>
<dt><em>-parsepcap</em> </dt>
<dd>Interpret the <em>payload</em> as a wireshark/tcpdump packet capture file. The packets will be extracted from the pcap file to construct the actual payload to be walked. Only IPv4+TCP/UDP packets are parsed. The pcap file must contain a single unidirectional stream of packets to get the desired match-result. </dd>
</dl>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-showstats</em> </dt>
<dd>Shows statistics related to the walk, viz. Number of bytes scanned, cache node hits, and cache node misses. These stats determines cached nodes that were hit during the walk (cache node miss means memory node hit). </dd>
</dl>
<h2><a class="anchor" id="hfatools_perfdiag"></a>
Performance Diagnostics</h2>
<dl>
<dt></dt>
<dd></dd>
<dt><em>-diag</em> </dt>
<dd><p class="startdd">If the graph has been compiled with <b>diag</b> option of the <a class="el" href="octeon_hfa_tools.html#hfa_compiler">HFA RegEx Complier</a>, then this option can used to report CPU cycles spent on post-processing partial matches. This information can be used to identify which patterns are using an inordinately high level of resources and are candidates to be re-written or excluded from the graph. For eg: Taking pattern, payload and graph file mentioned above in <a class="el" href="octeon_hfa_tools.html#hfa_compiler">HFA RegEx Complier</a> </p>
<pre class="fragment">bash&gt;# hfac -input pattern_file -out graph-file --target cn68xx -diag
Processed 2 lines
Building [&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;] 100.00%

SIZE DIAGNOSTICS
----------------

    Pattern Usage

    1   [&gt;&gt;&gt;&gt;&gt;&gt;&gt;             ] 38.89% (7/18)
    2   [&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;        ] 61.11% (11/18)

bash&gt;# hfaw -out graph-file -payload payload_file --diag
device: CN68XX

PERFORMANCE DIAGNOSTICS
-----------------------

    Pattern Usage

    1   [&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;   ] 88.57% (31/35)
    2   [&gt;&gt;                  ] 11.43% (4/35)

pattern matches

found 0 matches
</pre><p>Above shows that partial matches reported by HFA hardware are high as compared to total matches. <b> Lesser the partial matches more will be the run time performance </b>. This situation can be solved by using "-rcprofile" option of HFA compiler. </p>
<pre class="fragment">bash&gt;# hfac -input pattern_file -out graph-file --target cn68xx -diag -rcprofile rcfile

SIZE DIAGNOSTICS
----------------

    Pattern Usage

    1   [&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;            ] 40.00% (4/10)
    2   [&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;        ] 60.00% (6/10)

bash&gt;# hfaw -out graph-file -payload payload_file --diag
device: CN68XX

PERFORMANCE DIAGNOSTICS
-----------------------

    Pattern Usage


pattern matches

found 0 matches
</pre><p class="enddd">In later case partial matches are zero as compared to former case </p>
</dd>
</dl>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>

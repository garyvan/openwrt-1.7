<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>OCTEON HFA SDK 3.1.0: REFERENCE APPLICATIONS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">OCTEON HFA SDK 3.1.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('octeon_hfa_sdk_apps.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">REFERENCE APPLICATIONS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="octeon_hfa_sdk_funcapps_list"></a>
Functional Applications</h1>
<p>The following reference applications can be compiled by following <a class="el" href="overview.html#hfasdk_compile">COMPILATION</a> section. The binares are named as hfa-&lt;OCTEON_MODE&gt;-&lt;type of application&gt;. For ex: <a class="el" href="hfa-se-nctx_8c.html" title="SE/SEUM: Reference application to showcase HFA API in asynchronous mode of operation using poll mode ...">hfa-se-nctx.c</a> will produce the binaries <b>hfa-se-nctx</b> and <b>hfa-seum-nctx</b> for SE and SEUM. <a class="el" href="hfa-lnx-nctx_8c.html" title="Linux Kernel mode: Reference application to showcase HFA API in asynchronous mode of operation using ...">hfa-lnx-nctx.c</a> will produce the module <b>hfa-kernel-nctx.ko</b> for Linux kernel environment. These applications can be found under $HFAROOT/apps/func.</p>
<ol type="1">
<li><a class="el" href="hfa-se_8c.html">hfa-se.c</a> and <a class="el" href="hfa-lnx_8c.html">hfa-lnx.c</a> : Simple example to showcase HFA synchronous application.</li>
<li><a class="el" href="hfa-se-linkgraph_8c.html">hfa-se-linkgraph.c</a> and <a class="el" href="hfa-lnx-linkgraph_8c.html">hfa-lnx-linkgraph.c</a> : Simple example to showcase linked HFA graphs.</li>
<li><a class="el" href="hfa-se-ngraphs_8c.html">hfa-se-ngraphs.c</a> : Simple example to showcase loading multiple HFA graphs and perform search on each graph.</li>
<li><a class="el" href="hfa-se-xml-parser_8c.html">hfa-se-xml-parser.c</a> : Simple example to showcase how to parse XML file and submit actual data for search. (See <b>Note</b>)</li>
<li><a class="el" href="hfa-se-async_8c.html">hfa-se-async.c</a> and <a class="el" href="hfa-lnx-async_8c.html">hfa-lnx-async.c</a> : Simple example to showcase HFA asynchronous application.</li>
<li><a class="el" href="hfa-se-nctx_8c.html">hfa-se-nctx.c</a> and <a class="el" href="hfa-lnx-nctx_8c.html">hfa-lnx-nctx.c</a> : Application to showcase more than one search context used to submit search request to hardware without locking.</li>
<li><a class="el" href="hfa-se-nctx-lock_8c.html">hfa-se-nctx-lock.c</a> and <a class="el" href="hfa-lnx-nctx-lock_8c.html">hfa-lnx-nctx-lock.c</a> : Application to showcase more than one search context used to submit search request to hardware with locking.</li>
<li><a class="el" href="hfa-se-wqe_8c.html">hfa-se-wqe.c</a> and <a class="el" href="hfa-lnx-wqe_8c.html">hfa-lnx-wqe.c</a> : A lockless example to showcase WQE based asynchronous application.</li>
<li><a class="el" href="hfa-se-wqe-lock_8c.html">hfa-se-wqe-lock.c</a> and <a class="el" href="hfa-lnx-wqe-lock_8c.html">hfa-lnx-wqe-lock.c</a> : A lock-based example to showcase WQE based asynchronous application.</li>
<li><a class="el" href="hfa-se-flow_8c.html">hfa-se-flow.c</a> A more complex example which uses network packet flows (<b>Stateful Contexts</b>) to serialize packets among contexts. Polling mode is used for search get status(See <b>Note</b>).</li>
<li><a class="el" href="hfa-se-flow-wqe_8c.html">hfa-se-flow-wqe.c</a> A more complex example which uses network packet flows (<b>Stateful Contexts</b>) to serialize packets among contexts. WQE mode is used for search getstatus (See <b>Note</b>)</li>
</ol>
<p><b>Note</b> </p>
<ul>
<li><b> Stateful Contexts</b> (or Flows) are generated dynamically depending upon the ingress packets. Flow is calculated on the basis of five tuple fields (source IP address, destination IP address, source port, destination port and protocol) in packet. Different combinations of these five tuple fields will create different flow. Good performance can be achieved when multiple flows (or Stateful Context) are created.</li>
<li><p class="startli"><b>Traffic-gen</b> program at $OCTEON_ROOT/examples/traffic-gen/ can be used to generate packets having different five tuple fields. As an example, 64 flows can be created by stimulating 64 source machines pumping packet to OCTEON. This can be done as follows using Traffic-Gen program</p>
<p class="startli"><b>traffic-gen &gt;#</b> ip.src.min 10.0.0.1<br/>
 <b>traffic-gen &gt;#</b> ip.src.max 10.0.0.64 <br/>
 <b>traffic-gen &gt;#</b> ip.src.inc 1 <br/>
 <b>traffic-gen &gt;#</b> start</p>
</li>
<li>Flow (or <b> Stateful Context</b>) based applications only support network based payload and do not support file based payload</li>
<li>Sample pattern file $HFAROOT/apps/ref-files/xml_patterns for reference application <a class="el" href="hfa-se-xml-parser_8c.html">hfa-se-xml-parser.c</a> /<b>hfa-seum-xml-parser.c</b> must be compiled in &ndash;regex mode of <a class="el" href="octeon_hfa_tools.html#hfa_compiler">HFA RegEx Complier</a></li>
</ul>
<h1><a class="anchor" id="octeon_hfa_sdk_perfapps_list"></a>
Performance Benchmarking Applications</h1>
<p>The following performance benchmarking applications are compiled when the HFA Library is compiled. The binares are named as hfa-&lt;OCTEON_MODE&gt;-&lt;type of application&gt;. These applications can be found under apps/perf</p>
<ul>
<li><a class="el" href="hfa-se-ctx_8c.html">hfa-se-ctx.c</a> : Poll based asynchronous performance application with <b> Stateless Contexts </b>.</li>
<li><a class="el" href="hfa-lnx-ctx_8c.html">hfa-lnx-ctx.c</a> : Poll based asynchronous performance application with <b> Stateless Contexts </b>.</li>
</ul>
<p><b>Note</b> </p>
<ul>
<li>Use verbose option with performance applications to get more performance details</li>
</ul>
<h1><a class="anchor" id="octeon_hfa_sdk_apps_launch_se"></a>
Run SE Reference Applications</h1>
<p>In SE environment, the application programs can be run using the following steps at the uboot prompt. The steps below use <b>hfa-se</b> as the application. It must be changed to match the application you want to run.</p>
<ol type="1">
<li>Copy the tar file (containing <b>graph</b> file, <b>payload</b> file) and <b>hfa-se</b> program file to your host PC's tftp root directory (or) compact flash. <b>graph</b> file can be obtained by compiling the <b>pattern</b> file using <b>hfac</b> </li>
<li>Type the following commands at the OCTEON bootloader prompt, if you have tftp server setup. If you're using compact flash, replace the <b>tftp</b> command with the <b>fatload ide</b> command to load files.tar(tarball containing graph and payload files) <pre class="fragment">Octeon ebb6800# tftp $(loadaddr) files.tar
Octeon ebb6800# namedalloc files $(filesize)
Octeon ebb6800# cp.b $(loadaddr) $(named_block_addr) 0x$(filesize)
Octeon ebb6800# tftp $(loadaddr) hfa-se
</pre></li>
<li>Launch the application using the following command. The command uses only one of the many options accepted by the application. <pre class="fragment">Octeon ebb6800# bootoct $(loadaddr) numcores=&lt;num&gt; endbootargs hfa-se [-options]
</pre></li>
</ol>
<h2><a class="anchor" id="octeon_hfa_sdk_apps_options_se"></a>
Options for SE reference applications</h2>
<p>SE applications accept the following options. Not all options are applicable for all applications in all cases. Please refer to documentation for each application for more details.</p>
<ul>
<li><b>--fs=Named-block</b> name of filesystem(default is "files"). See <b><b>Note</b> below</b> </li>
<li><b>--graph=&lt;name&gt;</b> Graph file name (default is "graph")</li>
<li><b>--payload=&lt;name&gt;</b> Payload file name (default is "payload")</li>
<li><b>--clmsk=&lt;mask&gt;</b> Bitmask controlling graph loads on which cluster</li>
<li><b>--chunksize=&lt;size&gt;</b> chunk size in bytes.</li>
<li><b>--cluster=&lt;num&gt;</b> Cluster to which search request submit. cluster= -1 will choose anyone available cluster based on load.</li>
<li><b>--matchacross=&lt;num&gt;</b> Value of 0 or 1 to disable/enable reporting matches that straddle packet boundaries(default is 1)</li>
<li><b>--singlematch=&lt;num&gt;</b> Value of 0 or 1 disable/enable reporting only one match per-chunk per-search(default is 0)</li>
<li><b>--verbose=&lt;num&gt;</b> Value of 0 or 1 to disable/enable printing more detailed console output(default is 0)</li>
<li><b>--pcap=&lt;num&gt;</b> Value of 0 or 1 disable/enable PCAP(default is 0). (<a class="el" href="hfa-se_8c.html">hfa-se.c</a> and <a class="el" href="hfa-se-async_8c.html">hfa-se-async.c</a>)</li>
<li><b>--ngraphs=&lt;num&gt;</b> Number of graphs to load if multigraph option is enabled(default is 1). (<a class="el" href="hfa-se-ngraphs_8c.html">hfa-se-ngraphs.c</a>)</li>
<li><b>--nctx=&lt;num&gt;</b> Number of search context used (not applicable for all apps) (<a class="el" href="hfa-se-nctx_8c.html">hfa-se-nctx.c</a>, <a class="el" href="hfa-se-nctx-lock_8c.html">hfa-se-nctx-lock.c</a>)</li>
<li><b>--nflows=&lt;num&gt;</b> Number of per-core flows to create in flow-based reference application(default is 64 per core). (<a class="el" href="hfa-se-flow_8c.html">hfa-se-flow.c</a>, <a class="el" href="hfa-se-flow-wqe_8c.html">hfa-se-flow-wqe.c</a>)</li>
<li><b>--network=&lt;num&gt;</b> Value of 0 or 1 disable/enable Network based payload. Applicable to performance benchmarking and flow-based reference applications. It causes the application to pick up packets from the SSO unit(default is 1). (<a class="el" href="hfa-se-ctx_8c.html">hfa-se-ctx.c</a>)</li>
<li><b>--npkts=&lt;num&gt;</b> Number of per-core local packets to generate in performance application in case of buffer/pcap-based operation(default is 100 per core). (<a class="el" href="hfa-se-ctx_8c.html">hfa-se-ctx.c</a>)</li>
</ul>
<p><b>Note:</b> </p>
<ul>
<li>SE applications require graph file and payload file as part of tarball copied to the Named block.</li>
<li>The tarball (<b>files.tar</b>) must be created using the UNIX <b>tar</b> utility. The graph and payload files must be part of the tarball.</li>
<li>The tarball must be made available via a Named-Block created using uboot command <b>namedalloc</b> .</li>
<li>The <b>fs</b> option will hold the name of the Named-Block. The tar ball can contain more than one graph and payload file.</li>
<li>The applications assume that default name as "graph" and "payload" for graph and payload file respectively. However this behaviour can be overridden by passing <b>graph</b> and <b>payload</b> options.</li>
<li>Graph and Payload file name in the tar ball are passed to the applications as an argument. Following command can be used to create the tar ball. Here "files.tar" is taken as an example <pre class="fragment">    tar -cvf files.tar &lt;graph1&gt; &lt;payload1&gt; &lt;graph2&gt; &lt;payload2&gt; ...... so on
</pre></li>
<li>The tarball can contain compressed and uncompressed combinations of graph and payload files. For this purpose the graph or payload file must be compressed using UNIX <b>gzip</b> utility and must be part of files.tar. Following sequence of commands can be used to create tar ball having compressed graph and payload. "graph" and "payload" are taken as an example for graph and payload file name respectively <pre class="fragment">    hfac -input &lt;pattern file&gt; -out graph
    gzip graph
    gzip payload
    tar -cvf files.tar graph.gz payload.gz
</pre></li>
<li>In case application supports &ndash;pcap=1 option, only TCP/UDP packets are treated as valid and submitted to HFA engine. Remaining protocol and header fields are ignored.</li>
<li>Application will treat PCAP file as normal file if application is launched with &ndash;pcap=0</li>
<li>By default <b>hfa-se-ngraphs</b> application requires tarball must contain graph files with naming convention as {<b>graph1</b>, <b>graph2</b>...till <b>graph&lt;ngraphs&gt;</b> }.</li>
</ul>
<h1><a class="anchor" id="octeon_hfa_sdk_apps_launch_seum"></a>
Run SEUM Reference Applications</h1>
<p>In SE-UM the application programs can be executed by running the application binary on the Linux shell. Note that the Linux kernel must not own all of the available DRAM. In SEUM env the HFA SDK makes use of DRAM using the bootmem setup by uboot. The application which uses the HFA SDK API will have additional memory requirements. The example below uses <b>hfa-seum</b> with a couple of options to illustrate the usage. </p>
<pre class="fragment">$ ./hfa-seum --graph=&lt;graph file&gt; --payload=&lt;payload file&gt; [-options]
</pre><h2><a class="anchor" id="octeon_hfa_sdk_apps_options_seum"></a>
Options for SEUM reference applications</h2>
<p>SEUM applications accept the following options. (Not all options are applicable for all applications in all cases)</p>
<ul>
<li><b>--graph=&lt;name&gt;</b> Graph file name (default is "graph")</li>
<li><b>--payload=&lt;name&gt;</b> Payload file name (default is "payload")</li>
<li><b>--clmsk=&lt;mask&gt;</b> Bitmask controlling graph loads on which cluster</li>
<li><b>--chunksize=&lt;size&gt;</b> chunk size in bytes.</li>
<li><b>--cluster=&lt;num&gt;</b> Cluster to which search request submit. cluster= -1 will choose anyone available cluster based on load.</li>
<li><b>--matchacross=&lt;num&gt;</b> Value of 0 or 1 to disable/enable reporting matches that straddle packet boundaries(default is 1)</li>
<li><b>--singlematch=&lt;num&gt;</b> Value of 0 or 1 disable/enable reporting only one match per-chunk per-search(default is 0)</li>
<li><b>--verbose=&lt;num&gt;</b> Value of 0 or 1 to disable/enable printing more detailed console output(default is 0)</li>
<li><b>--pcap=&lt;num&gt;</b> Value of 0 or 1 disable/enable PCAP(default is 0). (<b>hfa-seum.c</b>, <b>hfa-seum-async.c</b> and <b>hfa-seum-ctx.c</b>)</li>
<li><b>--ngraphs=&lt;num&gt;</b> Number of graphs to load if multigraph option is enabled(default is 1). (<b>hfa-seum-ngraphs.c</b>)</li>
<li><b>--nctx=&lt;num&gt;</b> Number of search context used (not applicable for all apps) (<b>hfa-seum-nctx.c</b>, <b>hfa-seum-nctx-lock.c</b>)</li>
<li><b>--nflows=&lt;num&gt;</b> Number of per-core flows to create in flow-based reference application(default is 64 per core). (<b>hfa-seum-flow.c</b>, <b>hfa-seum-flow-wqe.c</b>)</li>
<li><b>--network=&lt;num&gt;</b> Value of 0 or 1 disable/enable Network based payload. Default value 1 for <b>hfa-seum-ctx.c</b>, <b>hfa-seum-flow.c</b> and <b>hfa-seum-flow-wqe.c</b>. Default value 0 for remaining applications</li>
<li><b>--npkts=&lt;num&gt;</b> Number of per-core local packets to generate in performance application in case of buffer/pcap-based operation(default is 100 per core). (<b>hfa-seum-ctx.c</b>)</li>
</ul>
<p><b>Note:</b> </p>
<ul>
<li>SEUM application will properly run on LINUX shell when enough bootmem memory is available for it. <b> Do not provide mem=0 option to "bootoctlinux" command as it will allow LINUX kenel to consume all bootmem memory</b>. Try loading LINUX kernel with mem=512M with "bootoctlinux" command</li>
<li>Reference applications <b>hfa-seum-wqe.c</b>, <b>hfa-seum-wqe-lock.c</b>, <b>hfa-seum-flow.c</b> and <b>hfa-seum-flow-wqe.c</b> requires <b> LINUX kernel to be loaded from bootoctlinux command using &ndash;numcores option and not with &ndash;coremask option</b></li>
<li>The applications assume that graph name and payload name as "graph" and "payload" respectively. However this behaviour can be overridden by passing <b>graph</b> and <b>payload</b> options.</li>
<li>In case application supports &ndash;pcap=1 option, only TCP/UDP packets are treated as valid and submitted to HFA engine. Remaining protocol and header fields are ignored.</li>
<li>Application will treat PCAP file as normal file if application is launched with &ndash;pcap=0</li>
<li>By default <b>hfa-seum-ngraphs</b> application requires current folder must contain graph files with naming convention as {<b>graph1</b>, <b>graph2</b>........<b>graph&lt;ngraphs&gt;}</b> </li>
</ul>
<h1><a class="anchor" id="octeon_hfa_sdk_apps_launch_kernel"></a>
Run LINUX Kernel Reference Applications</h1>
<p>Running HFA application in Linux kernel environment requires kernel memory. OCTEON CN68XX, CN60/61XX &amp; CN70/71XX requires reserving kernel memory before executing any HFA kernel application. This can be done by creating 64KB-aligned namedblock before booting OCTEON-LINUX. For ex: The following uboot command creates a 512MByte, 64KB-aligned namedblock with name <b>"hfamemory"</b>. The second argument to the namedalloc command is the starting address of the namedblock and it ensures 64KB-alignment. Any other 64KB-aligned address can be used.</p>
<pre class="fragment">namedalloc hfamemory 0x20000000 0x60000000
</pre><h2><a class="anchor" id="octeon_hfa_sdk_kernel_module"></a>
Run OCTEON HFA SDK LINUX Kernel Module</h2>
<p>After booting OCTEON-Linux, insert the HFA kernel library module <a class="el" href="cvm-hfa-module_8c.html#ae7dd9beda3446d7dd10ca08f66b7c22a">HFA_LIB_MODULE</a> as shown below </p>
<pre class="fragment">insmod cvm-hfa-lib.ko [-options]
</pre><h2><a class="anchor" id="octeon_hfa_sdk_kernel_module_op"></a>
Options for the HFA SDK LINUX Kernel module</h2>
<p>The HFA LINUX kernel module takes following module parameters while launching (<a class="el" href="octeon_hfa_sdk_apps.html#octeon_hfa_sdk_apps_launch_kernel">Run LINUX Kernel Reference Applications</a>)</p>
<ul>
<li><a class="el" href="hfa-lnx-ctx_8c.html#ad8919f785a63d0976904f0196954f999">hfa_napi_perf</a> - [0/1] If set 1 NAPI interface will be initialized</li>
<li><a class="el" href="cvm-hfa-module_8c.html#a737e183529cd8397b7ed0de5a2e75ea5">hfa_set_irq_affinity_path</a>= Location of file on OCTEON LINUX which sets irq affinity. Copy <b> $HFAROOT/apps/ref-files/hfa_set_irq_affinity.sh </b> in OCTEON-LINUX and provide the file path to this option.</li>
<li><a class="el" href="hfa-lnx-ctx_8c.html#a6d2b8178472198bb9e10dfb11d5a49c4">hfa_distribute_load</a>=[0/1] - Distribute packets depending upon the WQE group.</li>
<li><a class="el" href="cvm-hfa-module_8c.html#ae187042ebf0c1b898149db41179f1fcb">octeon_ethernet_driver_pow_group</a> - OCTEON POW group on which LINUX ethernet driver listening to the network packets (default 15)</li>
<li><a class="el" href="hfa-lnx-ctx_8c.html#a2f1497780b1c3423671318248f95f424">hfa_pow_receive_group</a> - SSO WQE grp on which NAPI will run (default is 14) (valid if hfa_distribute_load==0)</li>
<li><a class="el" href="cvm-hfa-module_8c.html#a75e8edebfd59fbf5d030548bc2737e11">hfa_mem_nb_name</a> - Named-block reserved for HFA memory (default name: "hfamemory") (for cn60/61/68/70/71xx only)</li>
<li><a class="el" href="cvm-hfa-module_8c.html#ac86248ae097afe1c574fcd49d730b91d">hfa_mem_sz</a> - Size of named-block (in MB) reserved for HFA Memory (for cn60/61/68/70/71xx only) (default is 128MB)</li>
<li><a class="el" href="cvm-hfa-module_8c.html#a7861a010aebb1b63ac7bbfae13545df0">hfa_tbuf_cnt</a> - Temporary buffer count (default is 60000)</li>
<li><a class="el" href="cvm-hfa-module_8c.html#af8a1857c2e0ff200e84bcc9c4dd6593e">hfa_cmdbuf_cnt</a> - HFA command buffer count (default is 60000)</li>
<li><a class="el" href="cvm-hfa-osapi_8h.html#ab774888eab2208c232c693691f7c3f7e">hfa_ppbuf_cnt</a> - PP buffer pool count (default is 60000) load to the cores (default is 0)</li>
<li><a class="el" href="cvm-hfa-module_8c.html#ab8bd7c4c67ea91347b3f866856004953">hfa_rx_napi_weight</a> - The NAPI Weight parameter (default is 32)</li>
</ul>
<p><b>Note</b> </p>
<ul>
<li>In case of "kernel" HFA environment, HFA kernel library module must be built before the kernel environment applications.</li>
<li>In case of WQE based LINUX kernel applications (<a class="el" href="hfa-lnx-wqe-lock_8c.html" title="Linux Kernel mode: Reference application to showcase HFA API in asynchronous mode of operation using ...">hfa-lnx-wqe-lock.c</a>) the HFA kernel module <a class="el" href="cvm-hfa-module_8c.html#ae7dd9beda3446d7dd10ca08f66b7c22a">HFA_LIB_MODULE</a> has to be inserted with additional module parameters as <pre class="fragment">    #  insmod cvm-hfa-lib.ko hfa_napi_perf=1 hfa_distribute_load=0 hfa_set_irq_affinity_path=&lt;irq_affinity_file_path&gt;
</pre></li>
<li>In case of WQE based LINUX kernel applications (<a class="el" href="hfa-lnx-wqe_8c.html" title="Linux Kernel mode: Reference application to showcase HFA API in asynchronous mode of operation using ...">hfa-lnx-wqe.c</a>) the HFA kernel module <a class="el" href="cvm-hfa-module_8c.html#ae7dd9beda3446d7dd10ca08f66b7c22a">HFA_LIB_MODULE</a> has to be inserted with additional module parameters as <pre class="fragment">    #  insmod cvm-hfa-lib.ko hfa_napi_perf=1 hfa_distribute_load=1 hfa_set_irq_affinity_path=&lt;irq_affinity_file_path&gt;
</pre></li>
</ul>
<h2><a class="anchor" id="octeon_hfa_sdk_kernel_app"></a>
Run OCTEON HFA SDK LINUX Kernel Reference Applications</h2>
<p>The command below uses <b>hfa-kernel.ko</b> application with a couple of options to illustrate this step. </p>
<pre class="fragment">insmod hfa-kernel.ko graph=&lt;graph file&gt; payload=&lt;payload file&gt; [-options]
</pre><h2><a class="anchor" id="octeon_hfa_sdk_kernel_app_op"></a>
Options for LINUX Kernel Reference Applications</h2>
<p>For Kernel environment, these applications accept the following options. Not all options are applicable for all applications in all cases. Please refer to documentation for each application for more details.</p>
<ul>
<li><b>graph=&lt;name&gt;</b> Graph file name (default is "graph")</li>
<li><b>payload=&lt;name&gt;</b> Payload file name (default is "payload")</li>
<li><b>chunksize=&lt;size&gt;</b> chunk size in bytes.</li>
<li><b>nctx=&lt;num&gt;</b> Number of search context used (<a class="el" href="hfa-lnx-nctx_8c.html">hfa-lnx-nctx.c</a> and <a class="el" href="hfa-lnx-nctx-lock_8c.html">hfa-lnx-nctx-lock.c</a>)</li>
<li><b>cluster=&lt;num&gt;</b> Cluster to which search request submit</li>
<li><b>matchacross=&lt;num&gt;</b> Value of 0 or 1 to disable/enable reporting matches that straddle packet boundaries(default is 1)</li>
<li><b>singlematch=&lt;num&gt;</b> Value of 0 or 1 disable/enable reporting only one match per-chunk per-search(default is 0)</li>
<li><b>pcap=&lt;num&gt;</b> Value of 0 or 1 disable/enable PCAP(default is 0). (<a class="el" href="hfa-lnx_8c.html">hfa-lnx.c</a>, <a class="el" href="hfa-lnx-async_8c.html">hfa-lnx-async.c</a> and <a class="el" href="hfa-lnx-ctx_8c.html">hfa-lnx-ctx.c</a>)</li>
<li><b>verbose=&lt;num&gt;</b> Value of 0 or 1 to disable/enable printing more detailed console output(default is 0)</li>
<li><b>npkts=&lt;num&gt;</b> Number of per-core packets to generate in performance application in case of buffer/pcap-based operation(default is 100 per core). (ref <a class="el" href="hfa-lnx-ctx_8c.html" title="Linux Kernel mode: Performance benchmarking application to illustrate HFA Engine performance.">hfa-lnx-ctx.c</a>)</li>
<li><b>network=&lt;num&gt;</b> Value of 0 or 1 disable/enable Network based payload support. Default value 1 for <a class="el" href="hfa-lnx-ctx_8c.html">hfa-lnx-ctx.c</a>. Rest applications have default value 0</li>
<li><b>tasks_mask=&lt;mask&gt;</b> Cores running tasklets(default mask is 0). See <b>Note</b> below</li>
<li><b>threads_mask=&lt;mask&gt;</b> Cores running threads(default mask is 1). See <b>Note</b> below</li>
<li><b> port= &lt;interface names&gt; </b> Comma seperated list of Linux interface names. This is applicable only for Linux env performance benchmarking application when with <b>network=1</b> option. It specifies the list of interfaces on which the application will snoop for network packets.</li>
</ul>
<p><b>Note:</b> </p>
<ul>
<li>chunksize must be less than payload size. The maximum limit for chunksize is 65535 bytes.</li>
<li>The kernel applications will run in thread-mode on only one core by default. This behaviour can be altered to run threads and/or tasklets on multiple cores using <b>tasks_mask</b> and <b>threads_mask</b> options. The two mask settings are mutually exclusive i.e. the application will run either in thread mode OR in tasklet mode on a given core, but not both on the same core.</li>
<li>The <b>network</b> option will cause the application to pick up packets from SSO unit. The kernel environment HFA SDK can co-exist with the Cavium Linux ethernet driver which also picks up network packets from the SSO. However, when HFA SDK is used in SEUM, the ethernet driver must not be used, since the two entities are not aware of each other and hence can cause mutual corruption of the FPA pools.</li>
<li>In case application supports pcap=1 option, only TCP/UDP packets are treated as valid and submitted to HFA engine. Remaining protocol and header fields are ignored.</li>
<li>Application will treat PCAP file as normal file if application is launched with pcap=0</li>
<li>Ensure that the Linux Kernel has sufficient memory so that the OCTEON ethernet driver and performance application can run with high buffer counts.</li>
<li>Network based LINUX kernel performance application <a class="el" href="hfa-lnx-ctx_8c.html" title="Linux Kernel mode: Performance benchmarking application to illustrate HFA Engine performance.">hfa-lnx-ctx.c</a> requires incoming port info. Use following sequence of commands to run application in network mode. (Following command uses incoming ports (xaui0, xaui1) as an example) <pre class="fragment">modprobe octeon-ethernet num_packet_buffers=60000
insmod cvm-hfa-lib.ko
insmod hfa-kernel-ctx.ko graph=&lt;graph file&gt; port=xaui0,xaui1 network=1
</pre></li>
<li>LINUX performance example (<a class="el" href="hfa-lnx-ctx_8c.html" title="Linux Kernel mode: Performance benchmarking application to illustrate HFA Engine performance.">hfa-lnx-ctx.c</a>) also takes payload file as an argument. Use following sequence of commands to run application with payload file. <pre class="fragment">modprobe octeon-ethernet num_packet_buffers=60000
insmod cvm-hfa-lib.ko hfa_napi_perf=1 hfa_distribute_load=0
insmod hfa-kernel-ctx.ko graph=&lt;graph file&gt; payload=&lt;payload file&gt; network=0
</pre> </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.2 </li>
  </ul>
</div>
</body>
</html>
